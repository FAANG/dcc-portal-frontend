<div class="container">
  <app-header></app-header>
  <h3 class="text-center">{{fileId}}</h3>
  <dl class="row">
    <dt class="col-sm-3">File name:</dt> <dd class="col-sm-9">{{ file?.name }}</dd>

    <dt class="col-sm-3">Release date:</dt> <dd class="col-sm-9">{{file?.releaseDate}}</dd>

    <dt class="col-sm-3">Update date:</dt> <dd class="col-sm-9">{{file?.updateDate}}</dd>

    <dt class="col-sm-3">Organism:</dt>
    <dd class="col-sm-9">
      <app-robust-link prefix="https://www.ebi.ac.uk/ols/terms?iri=" [link]="file?.species?.ontologyTerms" [text]="file?.species?.text"></app-robust-link>
    </dd>

    <dt class="col-sm-3">Specimen:</dt>
    <dd class="col-sm-9">
      <app-robust-link prefix="../specimen/" [link]="file?.specimen" [text]="file?.specimen"></app-robust-link>
    </dd>

    <ng-container *ngIf="file?.organism">
      <dt class="col-sm-3">BioSample ID:</dt>
      <dd class="col-sm-9">
        <app-robust-link prefix="../organism/" [link]="file?.organism" [text]="file?.organism"></app-robust-link>
      </dd>
    </ng-container>

    <dt class="col-sm-3">File size:</dt> <dd class="col-sm-9">{{file?.size}} ({{file?.readableSize}})</dd>

    <dt class="col-sm-3">Archive:</dt> <dd class="col-sm-9">{{file?.archive}}</dd>

    <dt *ngIf="file?.readCount" class="col-sm-3">Read count:</dt> <dd class="col-sm-9">{{file?.readCount}}</dd>

    <dt *ngIf="file?.baseCount" class="col-sm-3">Base count:</dt> <dd class="col-sm-9">{{file?.baseCount}}</dd>

    <dt *ngIf="file?.submission" class="col-sm-3">Submission:</dt>
    <dd class="col-sm-9">
      <app-robust-link prefix="https://www.ebi.ac.uk/ena/data/view/" [link]="file?.submission" [text]="file?.submission"></app-robust-link>
    </dd>

    <dt *ngIf="file?.experiment?.accession" class="col-sm-3">Experiment:</dt>
    <dd class="col-sm-9">
      <app-robust-link prefix="https://www.ebi.ac.uk/ena/data/view/" [link]="file?.experiment?.accession" [text]="file?.experiment?.accession"></app-robust-link>
      <button type="button" class="btn btn-info btn-sm" (click)="ngxSmartModalService.getModal('myModal').open()">Open experiment info</button>
    </dd>

    <dt *ngIf="file?.study?.accession" class="col-sm-3">Study:</dt>
    <dd class="col-sm-9">
      <app-robust-link prefix="../dataset/" [link]="file?.study?.accession" [text]="file?.study?.accession"></app-robust-link>
    </dd>

    <dt *ngIf="file?.study?.title" class="col-sm-3">Study title:</dt> <dd class="col-sm-9">{{file?.study?.title}}</dd>

    <dt *ngIf="file?.run?.accession" class="col-sm-3">Run:</dt>
    <dd class="col-sm-9">
      <app-robust-link prefix="https://www.ebi.ac.uk/ena/data/view/" [link]="file?.run?.accession" [text]="file?.run?.accession"></app-robust-link>
    </dd>

    <dt *ngIf="file?.run?.platform" class="col-sm-3">Platform:</dt> <dd class="col-sm-9">{{file?.run?.platform}}</dd>

    <dt *ngIf="file?.run?.instrument" class="col-sm-3">Instrument:</dt> <dd class="col-sm-9">{{file?.run?.instrument}}</dd>

    <dt *ngIf="file?.run?.centerName" class="col-sm-3">Center name:</dt> <dd class="col-sm-9">{{file?.run?.centerName}}</dd>

    <ng-container *ngIf="file?.run?.sequencingDate">
      <dt class="col-sm-3">Sequencing date:</dt>
      <dd class="col-sm-9">{{file?.run?.sequencingDate}}</dd>
    </ng-container>

    <dt *ngIf="file?.run?.sequencingLocation" class="col-sm-3">Sequencing location:</dt> <dd class="col-sm-9">{{file?.run?.sequencingLocation}}</dd>

    <dt *ngIf="file?.run?.sequencingLatitude" class="col-sm-3">Sequencing latitude:</dt> <dd class="col-sm-9" *ngIf="file?.run?.sequencingLatitude">{{file?.run?.sequencingLatitude}} (decimal degrees)</dd>

    <dt *ngIf="file?.run?.sequencingLongitude" class="col-sm-3">Sequencing longitude:</dt> <dd class="col-sm-9" *ngIf="file?.run?.sequencingLongitude">{{file?.run?.sequencingLongitude}} (decimal degrees)</dd>

    <ng-container  *ngIf="file && file.hasOwnProperty('experiment') && file.experiment.hasOwnProperty('standardMet')">
      <dt class="col-sm-3">Standard met:</dt> <dd class="col-sm-9">{{file.experiment.standardMet}}</dd>
    </ng-container>

  </dl>

  <hr>
  <div *ngIf="file?.paperPublished === 'true'" class="table-responsive">
    <h3>Published papers</h3>
    <table class="table table-striped table-hover table-borderless table-sm">
      <thead>
      <tr>
        <th>Title</th>
        <th>Year</th>
        <th>Journal</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let paper of file.publishedArticles">
        <td><app-robust-link prefix="https://doi.org/" [link]="paper.doi" [text]="paper.title"></app-robust-link></td>
        <td>{{paper.year}}</td>
        <td>{{paper.journal}}</td>
      </tr>
      </tbody>
    </table>
  </div>

  <app-run-files [runId]="file?.run?.accession" *ngIf="file?.run?.accession"></app-run-files>
  <div class="alert alert-danger" *ngIf="error"><p>{{ error }}</p></div>
  <ngx-smart-modal #myModal identifier="myModal" class="nsm-dialog-animation-fade" width="200%" customClass="msg-modal">
    <h3>{{file?.experiment?.accession}}</h3>
    <hr>
    <ng-container *ngIf="experiment && fieldNames">
      <ng-container *ngFor="let key of objectKeys(fieldNames)">

        <ng-container *ngIf="experiment.hasOwnProperty(key) && checkIsObject(experiment[key])">
          <ng-container *ngIf="experiment[key].hasOwnProperty('filename')">
            <p>
              <b>{{fieldNames[key]}}: </b> <br>
              <app-robust-link [link]="experiment[key]['url']" [text]="experiment[key]['filename'] | slice:0:62"></app-robust-link>
            </p>
          </ng-container>
          <ng-container *ngIf="experiment[key].hasOwnProperty('text')">
            <p>
              <b>{{fieldNames[key]}}: </b> <br>
              {{experiment[key]['text']}} ({{experiment[key]['unit']}})
            </p>
          </ng-container>
        </ng-container>

        <ng-container *ngIf="experiment.hasOwnProperty(key) && !checkIsObject(experiment[key])">
          <p>
            <b>{{fieldNames[key]}}: </b> <br>
            {{experiment[key]}}
          </p>
        </ng-container>

      </ng-container>
    </ng-container>
    <button (click)="myModal.close()" type="button" class="btn btn-success">Close</button>
  </ngx-smart-modal>
</div>
