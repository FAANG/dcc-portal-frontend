<div class="container">
  <app-header></app-header>
  <div class="container" style="margin: 10px;">
    <h3>Custom Queries</h3>
    <hr>
    <mat-form-field appearance="fill" style="width: 100%">
      <mat-label>Indices to display</mat-label>
      <mat-select [formControl]="indices" [(value)]="selectedIndices" (selectionChange)="updateDefaults($event.value)" multiple>
        <mat-option *ngFor="let index of indicesList" [value]="index">
          {{index}}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <div *ngIf="selectedIndices" class="row">
      <div class="col-md-3" *ngFor="let index of selectedIndices">
        <h6>{{displayName(index)}}</h6>
        <mat-form-field appearance="fill" style="width: 100%">
          <mat-label>Select columns to display</mat-label>
          <mat-select [(value)]="selectedColumns[index]" multiple>
            <mat-option *ngFor="let col of columnsByIndex[index]['columns']" [value]="col">
              {{col}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <button *ngIf="selectedIndices" class="btn btn-success" 
      (click)="fetchRecords()" style="margin-bottom: 20px;">
      Update table
    </button>
    <br>
    <div *ngIf="tableData as data" style="width: 100%; overflow-x: scroll;">
        <app-table-client-side #tableComp
            [display_fields]="columnNames"
            [column_names]="columnNames"
            [data]="data"
            [filter_values]="filter_field"
            [templates]="templates"
            [page_size]=10>
        </app-table-client-side>
    </div>
    <div *ngIf="loading">
        <mat-spinner [diameter]="30"></mat-spinner>
    </div>
  </div>
</div>