<div *ngIf="get_displayed_fields()['column_names']?.length > 0 && records && records.length > 0">
  <hr>
  <div ngbDropdown placement="bottom-right">
    <h3>
      Related
      <ng-container *ngIf="target_type == 'analysis'">Analyses</ng-container>
      <ng-container *ngIf="target_type != 'analysis'">{{capitalizeFirstLetter(target_type)}}s</ng-container>
      <button type="button" class="btn btn-success btn-sm" (click)="downloadAllFiles()" [disabled]="disableButton()"
              *ngIf="showButton()">Download all files ({{getUrlsLength()}})
      </button>

      <button class="btn btn-success btn-sm" id="dropdown" ngbDropdownToggle>Column selection</button>
      <ul ngbDropdownMenu aria-labelledby="dropdown">
        <ng-container *ngFor="let col of get_all_fields()['column_names']; let i = index">
          <li ngbDropdownItem *ngIf="i>0">
            <input type="checkbox" [value]="col" [checked]="isDisplayed(col)" [id]="col"
                   (click)="toggleSelectedColumn(col)" class="inner-input">
            <label [for]="col">{{col}}</label>
          </li>
        </ng-container>
      </ul>

    </h3>
  </div>
  <div *ngIf="(tableData | async) as data;">
    <app-table-client-side
      [display_fields]="displayFields"
      [column_names]="columnNames"
      [data]="data"
      [templates]="templates"
      [page_size]="10">
    </app-table-client-side>
  </div>
</div>

<ng-template #linkTemplate let-item>
  <app-robust-link [prefix]="get_field_values_for_links(item['col'])['prefix']"
                    [link]="getValue(item['row'], get_field_values_for_links(item['col'])['url'])"
                    [text]="getValue(item['row'], get_attr(item['col']))">
  </app-robust-link>
  <ng-container *ngIf="source_type === 'project' && target_type === 'organism' && isRecordPrivate(item['row'])">
    <i class="material-icons lock">lock</i>
  </ng-container>
</ng-template>

<ng-template #downloadTemplate let-item>
  <input type="checkbox" (click)="onCheckboxClick(getValue(item['row'],download_key))"
                   [checked]="CheckboxChecked(getValue(item['row'],download_key))">
</ng-template>

<ng-template #downloadHeaderTemplate let-item>
  {{item}} 
  <input id="mainBox" type="checkbox" [checked]="mainCheckboxChecked() == 2"
          [indeterminate]="mainCheckboxChecked() == 1" (click)="mainCheckboxClicked()">
</ng-template>