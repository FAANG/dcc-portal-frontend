<div class="container" style="min-height:87vh">
  <app-header></app-header>
  <h2>FAANG validation
    <button type="button" class="btn btn-info" aria-label="Left Align" [ngClass]="'active'"
            [routerLink]="['/validation', 'samples']">
      Samples
      <i class="material-icons float-right">home</i>
    </button>

    <button type="button" class="btn btn-info" aria-label="Left Align" [routerLink]="['/validation', 'experiments']">
      Experiments
      <i class="material-icons float-right">menu</i>
    </button>

    <button type="button" class="btn btn-info" aria-label="Left Align" [routerLink]="['/validation', 'analyses']">
      Analyses
      <i class="material-icons float-right">menu</i>
    </button>
  </h2>

  <hr>

  <div class="row">
    <div class="col-md-6">
      <button type="button" class="btn btn-success">
        <a href="{{metadata_template_with_examples}}">Download example template</a>
      </button>

      <button type="button" class="btn btn-success">
        <a href="{{metadata_template_without_examples}}">Download empty template</a>
      </button>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <button type="button" class="btn btn-info">
        <a href="https://dcc-documentation.readthedocs.io/en/latest/biosamples_template/" target="_blank">Submission guideline</a>
      </button>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6" id="left">
      <h3>1. Upload template:</h3>
      <input type="file" name="file" ng2FileSelect [uploader]="uploader" />
      <button type="button" class="btn btn-success btn-sm"
              (click)="uploader.uploadAll()"
              [disabled]="!uploader.getNotUploadedItems().length" >
        Upload a File
      </button>
    </div>
    <div class="col-md-6" id="right">
      <h3>2. Conversion results:</h3>
      <div class="row">
        <div class="col-md-6">
          Status: <span [ngClass]="statusClass(conversion_status)">{{conversion_status}}</span>
        </div>
        <div class="col-md-6">
          <button type="button" class="btn btn-success btn-sm" *ngIf="conversion_status === 'Success'"
                  (click)="startValidation()"
                  [disabled]="validation_started === true">
            Start validation
          </button>
        </div>
      </div>
      <div class="row" *ngIf="conversion_status === 'Error'">
        <div class="col-md-12">
          Errors:
          <div class="alert alert-danger" role="alert" *ngFor="let error of errors">
            {{error}}
          </div>
        </div>
      </div>
    </div>
  </div>

  <hr>

  <div class="row">
    <div class="col-md-6" *ngIf="validation_results">
      <h3>3. Validation results:</h3>
      Status: <span [ngClass]="statusClass(validation_status)">{{validation_status}}</span>
      <br>
      <button *ngFor="let key of record_types" type="button" class="btn btn-info validation_button"
              [ngClass]="isButtonActive(key)" (click)="onRecordButtonClick(key)">
        {{remove_underscores(key)}}
      </button>
    </div>

    <div class="col-md-6" *ngIf="!validation_results && validation_started">
      <h3>3. Validation results:</h3>
      Status: <span [ngClass]="statusClass(validation_status)">{{validation_status}}</span>
      <br>
    </div>

    <div class="col-md-6" *ngIf="validation_results">
      <h3>4. Get data for submission:</h3>
      Status: <span [ngClass]="statusClass(submission_status)">{{submission_status}}</span>
      <br>
      <button type="button" class="btn btn-success submission_data_button"
              *ngIf="submission_status !== 'Data is ready'" (click)="startConversion()"
              [disabled]="isSubmissionDisabled(submission_status)">
        Get submission data
      </button>

      <button type="button" class="btn btn-success submission_data_button" *ngIf="submission_status === 'Data is ready'">
        <a href="{{constructDownloadLink()}}">Download data</a>
      </button>
    </div>
  </div>

  <div class="row" *ngIf="validation_results">
    <div class="col-md-12">
      <button type="button" class="btn btn-success validation_button"
              (click)="onValidationResultsButtonClick('passed')"
              [ngClass]="isRecordsButtonActive('passed')">
        Records passed validation <span class="badge badge-light">{{records_that_pass.length}}</span>
      </button>
      <button type="button" class="btn btn-danger validation_button"
              (click)="onValidationResultsButtonClick('issues')"
              [ngClass]="isRecordsButtonActive('issues')">
        Records with issues <span class="badge badge-light">{{records_with_issues.length}}</span>
      </button>
      <button type="button" class="btn btn-success">
        Download annotated template
      </button>
    </div>
  </div>

  <div class="row" *ngIf="show_table">
    <div class="col-md-12 table-responsive">
      <table class="table table-striped table-hover table-borderless table-sm">
        <thead>
        <tr>
          <th *ngFor="let column of column_names">{{column}}</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let record of records_to_show; let i=index">
          <td *ngFor="let data of record; let j=index"
              [ngClass]="getCellClass(i, j)"
              [ngStyle]="{'cursor': getCellStyle(i, j)}"
              (click)="openModal(i, j)">{{data}}</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>


  <ngx-smart-modal #myModal identifier="myModal" customClass="nsm-dialog-animation-fade">
    <h3>{{active_column}}:</h3>
    <p *ngIf="active_issues">
      {{active_issues.split(',').join(' ')}}
    </p>
    <button (click)="myModal.close()" type="button" class="btn btn-success modal-button">Close</button>
  </ngx-smart-modal>

</div>
