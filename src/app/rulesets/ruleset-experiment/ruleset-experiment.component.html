<div class="container">
  <app-header></app-header>
  <h2>FAANG Rule sets
    <button type="button" class="btn btn-info" aria-label="Left Align" [routerLink]="['/ruleset', 'samples']">
      Samples
      <i class="material-icons float-right">menu</i>
    </button>

    <button type="button" class="btn btn-info" aria-label="Left Align" [ngClass]="'active'" [routerLink]="['/ruleset', 'experiments']">
      Experiments
      <i class="material-icons float-right">home</i>
    </button>

    <button type="button" class="btn btn-info" aria-label="Left Align" [routerLink]="['/ruleset', 'analyses']" fragment="faang">
      Analyses
      <i class="material-icons float-right">menu</i>
    </button>
  </h2>

  <dl class="row">
    <dt class="col-sm-3">Name:</dt>
    <dd class="col-sm-9">{{ name }}</dd>

    <dt class="col-sm-3">Description:</dt>
    <dd class="col-sm-9">{{ description }}</dd>

    <dt class="col-sm-3">Further details:</dt>
    <dd class="col-sm-9">
      <a href="{{ details }}">{{ details }}</a>
    </dd>
  </dl>

  <hr>

  <div class="alert alert-danger" *ngIf="error">
    <p>
      {{ error }}
    </p>
  </div>

  <ng-container *ngIf="(data | keyvalue)?.length">
  <div class="row">
    <div class="col-md-2"><h3>Rule groups</h3></div>
    <div class="col-md-10">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="defaultCheck1" (click)="mandatoryOnlyToggle()">
        <label class="form-check-label" for="defaultCheck1">
          Show only mandatory fields
        </label>
        <button type="button" class="btn btn-success">
          <a href="{{metadata_template_with_examples}}">Download example template</a>
        </button>
        <button type="button" class="btn btn-success">
          <a href="{{metadata_template_without_examples}}">Download empty template</a>
        </button>
        <button type="button" class="btn btn-success" *ngIf="active_rule !== 'Standard' && active_rule !== 'ChIP-seq_standard_rules'">
          <a href="{{record_specific_templates[active_rule]}}">Download {{active_rule}} template</a>
        </button>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-2 left">
      <ul *ngFor="let category of rule_groups" class="list-group list-group-flush">
        <li class="list-group-item"
            [ngClass]="{'active': checkIsActive(category)}">
          <a style="cursor: pointer" (click)="clickOnRule(category); clearUrlFragment();">{{category}}</a>
          </li>
      </ul>
    </div>
    <div class="col-md-10 table-responsive center">
      <h3>{{active_rule}} ({{length}} rules)</h3>
      <p *ngIf="active_rule === 'Standard'">Applied to all entities</p>
      <ng-container *ngIf="active_rule !== 'Standard'">
        <p>Applied under these conditions:</p>
        <p *ngIf="active_rule !== 'RNA-seq'">
          assay type is "{{getCondition('self')}}"
        </p>
        <p *ngIf="active_rule === 'ChIP-seq DNA-binding proteins'">
          experiment target is lead node descendant of <a
          href="https://www.ebi.ac.uk/ols/ontologies/so/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2FSO_0001700">
          SO_0001700
        </a>
        </p>
        <p *ngIf="active_rule === 'ChIP-seq input DNA'">
          experiment target is input DNA
        </p>
        <ng-container *ngIf="active_rule === 'RNA-seq'">
          <p>
            assay type is one of:
          </p>
          <p>
            microRNA profiling by high throughput sequencing
          </p>
          <p>
            RNA-seq of total RNA
          </p>
          <p>
            RNA-seq of coding RNA
          </p>
          <p>
            RNA-seq of non coding RNA
          </p>
          <p>
            transcription profiling by high throughput sequencing
          </p>
          <p>
            ISO-Seq
          </p>
        </ng-container>
      </ng-container>
      <table class="table table-striped table-hover table-borderless table-sm">
        <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Type</th>
          <th>Required?</th>
          <th>Allow multiple?</th>
          <th>Valid values</th>
          <th>Valid units</th>
          <th>Valid terms</th>
          <th>Condition</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let rule of rules">
          <ng-container
            *ngIf="rule !== 'describedBy' &&
            rule !== 'schema_version' &&
            rule !== 'experiments_core' &&
            rule !== 'input_dna' &&
            rule !== 'dna-binding_proteins'">
            <td>{{data['properties'][rule]['name']}}</td>
            <td>{{data['properties'][rule]['description']}}</td>
            <td>{{getType(data['properties'][rule])}}</td>
            <td>{{getMandatoryField(data['properties'][rule])}}</td>
            <td>{{allowMultiple(data['properties'][rule])}}</td>
            <td>{{getValidValues(data['properties'][rule])}}</td>
            <td>{{getValidUnits(data['properties'][rule])}}</td>
            <td>
              <ng-container *ngFor="let item of getValidTerms(data['properties'][rule]); let i=index">
                <ng-container *ngIf="getOntologyName(data['properties'][rule]).length === 1">
                  <a href="{{generateEbiOntologyLink(getOntologyName(data['properties'][rule])[0], item)}}">
                    {{item}}
                  </a>
                </ng-container>
                <ng-container *ngIf="getOntologyName(data['properties'][rule]).length !== 1">
                  <a href="{{generateEbiOntologyLink(getOntologyName(data['properties'][rule])[i], item)}}">
                    {{item}}
                  </a>
                </ng-container>
              </ng-container>
            </td>
            <td>{{getCondition(rule)}}</td>
          </ng-container>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
  </ng-container>

</div>
